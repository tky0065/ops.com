{
  "id": "flask-postgres",
  "name": "Flask + PostgreSQL + RabbitMQ",
  "description": "Lightweight Flask REST API with PostgreSQL database, Redis cache, RabbitMQ message broker, and background workers",
  "category": "Backend / Python API",
  "tags": ["Python", "Flask", "PostgreSQL", "Redis", "RabbitMQ", "REST API", "Microservices", "Message Queue"],
  "dockerCompose": "version: '3.8'\n\nservices:\n  # Flask API Application\n  flask-api:\n    image: python:3.11-slim\n    container_name: flask-api\n    ports:\n      - \"5000:5000\"\n    environment:\n      - FLASK_APP=app.py\n      - FLASK_ENV=production\n      - DATABASE_URL=postgresql://flaskuser:flaskpass@postgres:5432/flaskdb\n      - REDIS_URL=redis://:redispass@redis:6379/0\n      - RABBITMQ_URL=amqp://rabbitmq:rabbitmq@rabbitmq:5672//\n      - SECRET_KEY=change-me-in-production-please-use-env-var\n      - SQLALCHEMY_TRACK_MODIFICATIONS=False\n      - SQLALCHEMY_ECHO=False\n    volumes:\n      - ./app:/app\n    working_dir: /app\n    command: >\n      sh -c \"pip install --no-cache-dir -r requirements.txt &&\n             flask db upgrade &&\n             gunicorn app:app --bind 0.0.0.0:5000 --workers 2 --threads 4 --worker-class gthread --timeout 60 --log-level info\"\n    depends_on:\n      - postgres\n      - redis\n      - rabbitmq\n    healthcheck:\n      test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:5000/health\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n      start_period: 30s\n    networks:\n      - flask-network\n    restart: unless-stopped\n\n  # Background Worker (RabbitMQ Consumer)\n  flask-worker:\n    image: python:3.11-slim\n    container_name: flask-worker\n    environment:\n      - FLASK_APP=app.py\n      - FLASK_ENV=production\n      - DATABASE_URL=postgresql://flaskuser:flaskpass@postgres:5432/flaskdb\n      - REDIS_URL=redis://:redispass@redis:6379/0\n      - RABBITMQ_URL=amqp://rabbitmq:rabbitmq@rabbitmq:5672//\n      - SECRET_KEY=change-me-in-production-please-use-env-var\n      - WORKER_CONCURRENCY=4\n    volumes:\n      - ./app:/app\n    working_dir: /app\n    command: >\n      sh -c \"pip install --no-cache-dir -r requirements.txt &&\n             python worker.py\"\n    depends_on:\n      - postgres\n      - redis\n      - rabbitmq\n    healthcheck:\n      test: [\"CMD-SHELL\", \"ps aux | grep '[p]ython worker.py' || exit 1\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n      start_period: 20s\n    networks:\n      - flask-network\n    restart: unless-stopped\n\n  # PostgreSQL Database\n  postgres:\n    image: postgres:15-alpine\n    container_name: flask-postgres\n    ports:\n      - \"5432:5432\"\n    environment:\n      - POSTGRES_DB=flaskdb\n      - POSTGRES_USER=flaskuser\n      - POSTGRES_PASSWORD=flaskpass\n      - POSTGRES_INITDB_ARGS=--encoding=UTF-8\n    volumes:\n      - postgres-data:/var/lib/postgresql/data\n      - ./init-scripts:/docker-entrypoint-initdb.d\n    healthcheck:\n      test: [\"CMD-SHELL\", \"pg_isready -U flaskuser -d flaskdb\"]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n    networks:\n      - flask-network\n    restart: unless-stopped\n\n  # Redis Cache\n  redis:\n    image: redis:7-alpine\n    container_name: flask-redis\n    ports:\n      - \"6379:6379\"\n    command: redis-server --appendonly yes --requirepass redispass --maxmemory 256mb --maxmemory-policy allkeys-lru\n    volumes:\n      - redis-data:/data\n    healthcheck:\n      test: [\"CMD\", \"redis-cli\", \"--raw\", \"incr\", \"ping\"]\n      interval: 10s\n      timeout: 3s\n      retries: 5\n    networks:\n      - flask-network\n    restart: unless-stopped\n\n  # RabbitMQ Message Broker\n  rabbitmq:\n    image: rabbitmq:3.12-management-alpine\n    container_name: flask-rabbitmq\n    ports:\n      - \"5672:5672\"   # AMQP port\n      - \"15672:15672\" # Management UI\n    environment:\n      - RABBITMQ_DEFAULT_USER=rabbitmq\n      - RABBITMQ_DEFAULT_PASS=rabbitmq\n      - RABBITMQ_DEFAULT_VHOST=/\n      - RABBITMQ_VM_MEMORY_HIGH_WATERMARK=512MB\n    volumes:\n      - rabbitmq-data:/var/lib/rabbitmq\n      - ./rabbitmq/rabbitmq.conf:/etc/rabbitmq/rabbitmq.conf:ro\n    healthcheck:\n      test: [\"CMD\", \"rabbitmq-diagnostics\", \"-q\", \"ping\"]\n      interval: 30s\n      timeout: 10s\n      retries: 5\n      start_period: 30s\n    networks:\n      - flask-network\n    restart: unless-stopped\n\nvolumes:\n  postgres-data:\n    driver: local\n  redis-data:\n    driver: local\n  rabbitmq-data:\n    driver: local\n\nnetworks:\n  flask-network:\n    driver: bridge\n",
  "recommendedOptions": {
    "targetPlatform": "kubernetes",
    "proxyType": "traefik",
    "addHealthChecks": true,
    "addResourceLimits": true,
    "resourceProfile": "small",
    "addSecurity": true
  }
}
